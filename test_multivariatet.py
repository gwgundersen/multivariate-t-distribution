import numpy as np
from   multivariatet import multivariate_t
import matplotlib.pyplot as plt


# These tests were manually created by running vmap(mvtpdf(...)) in MATLAB.
tests = [{
	'x'    : np.array([1, 1]),
	'mu'   : np.zeros(2),
	'shape': np.array([[1, 0.6], [0.6, 1]]),
	'df'   : 5,
	'ans'  : 0.091105605557398647298406046957098
}, {
	'x'    : np.array([-10, 7.3]),
	'mu'   : np.zeros(2),
	'shape': np.array([[1, 0.6], [0.6, 1]]),
	'df'   : 8,
	'ans'  : 0.000000000776812391262925840494881
}, {
	'x': np.array([
	    [173, 1],
	    [747, 1],
	    [480, 5],
	    [655, 1],
	    [967, 1],
	    [316, 5],
	    [81, 4],
	    [793, 4],
	    [368, 6],
	    [587, 6],
	    [187, 4],
	    [81, 2],
	    [158, 1],
	    [828, 7],
	    [304, 7],
	    [387, 7],
	    [653, 5],
	    [819, 1],
	    [768, 1],
	    [377, 2],
	    [194, 1],
	    [648, 6],
	    [286, 5],
	    [641, 6],
	    [594, 4],
	    [328, 3],
	    [989, 6],
	    [127, 3],
	    [737, 3],
	    [160, 6],
	    [437, 4],
	    [833, 2],
	    [363, 6],
	    [80, 2],
	    [559, 7],
	    [277, 2],
	    [136, 1],
	    [701, 1],
	    [488, 6],
	    [186, 6],
	    [105, 6],
	    [205, 6],
	    [139, 7],
	    [327, 4],
	    [951, 6],
	    [535, 3],
	    [251, 7],
	    [440, 1],
	    [671, 7],
	    [550, 4],
	    [611, 3],
	    [864, 4],
	    [384, 3],
	    [750, 2],
	    [161, 5],
	    [62, 5],
	    [343, 6],
	    [818, 3],
	    [381, 2],
	    [973, 3],
	    [607, 3],
	    [341, 7],
	    [929, 6],
	    [899, 3],
	    [852, 5],
	    [260, 6],
	    [289, 6],
	    [781, 7],
	    [703, 5],
	    [495, 1],
	    [968, 2],
	    [479, 7],
	    [995, 3],
	    [493, 5],
	    [506, 6],
	    [770, 2],
	    [391, 4],
	    [456, 2],
	    [137, 1],
	    [760, 6],
	    [567, 1],
	    [651, 3],
	    [799, 2],
	    [224, 2],
	    [859, 5],
	    [906, 7],
	    [295, 1],
	    [727, 6],
	    [343, 6],
	    [276, 7],
	    [174, 7],
	    [666, 1],
	    [538, 4],
	    [830, 6],
	    [271, 5],
	    [180, 7],
	    [434, 7],
	    [478, 7],
	    [787, 1]
	]),
	'mu'   : np.zeros(2),
	'shape': np.array([[14.7, -2.1], [-2.1, 6.]]),
	'df'   : 50,
	'ans'  : np.array([
		2.4055076912228766385195227751718e-74,
		2.4354657504948888123131492246327e-107,
		2.1204691665916060035508388561065e-97,
		2.2566389189934296103731379481299e-104,
		3.6225071121077893932247418779099e-113,
		5.4388354210087078135512339036745e-88,
		1.6318950974521482005413908769948e-57,
		1.0428113484323834785047298330271e-108,
		1.9677104773394307950293224037642e-91,
		6.0755949025675919128447564329051e-102,
		3.4948887973732187163999292868671e-76,
		2.2617379947635822017320212354201e-57,
		2.6488284566237540148124674880273e-72,
		1.0597916681765948404046974713846e-109,
		3.7172187668151422103872605124299e-87,
		1.405513101817657083289574445135e-92,
		2.4603315645677060435270082061772e-104,
		2.0382112831313522123552832714524e-109,
		5.7637814233424692499539425265898e-108,
		6.4032922830555678055333247108134e-92,
		6.3211203727468824221139610938046e-77,
		3.5991110795239678706506571481585e-104,
		9.5080730178129403029737092758366e-86,
		6.322961466120499875392285487559e-104,
		3.4207158042271824902922513590905e-102,
		8.5026661537136084420398061919306e-89,
		1.0598136766177787491913705752859e-113,
		1.7842864996017931120455437875217e-67,
		4.7530646381642913009186788200172e-107,
		9.3066170198499586325573475375272e-73,
		2.8319841927564866320304440341131e-95,
		8.3271646849325369255121760491142e-110,
		3.9956420067269513823291118284012e-91,
		4.2782539282405521116905050193218e-57,
		7.4998443823375253624824365008957e-101,
		5.6766280411046066036587464904532e-85,
		6.2578593543208572786496697092993e-69,
		6.6273539601065830756819445392175e-106,
		8.7762135680835376259903215973345e-98,
		4.0156228843502725243393885158946e-76,
		2.1733661678767988072757891928579e-63,
		2.6719470168002016232291381282492e-78,
		1.1580248927002752545590035123974e-69,
		9.5992925656873047203019370398937e-89,
		8.1049585812251688163474470381429e-113,
		7.9816242267919543667671324004049e-100,
		7.3608736033861274857440045321872e-83,
		2.1535577961393005760995688942308e-95,
		5.7870162714272815148272800213946e-105,
		1.8582487446415780341043037370846e-100,
		8.060779206038050174970508085143e-103,
		1.2132900272948370089280760732662e-110,
		2.388224580485380726197962196968e-92,
		1.9467755566908400467707882184631e-107,
		7.3315087057242021073560430530413e-73,
		9.9735680843979372754769107099839e-52,
		7.5120447313033727371971257398658e-90,
		2.1103948741449065095978136532863e-109,
		3.7018645112402863965007787756178e-92,
		2.5638496370904300244119707719675e-113,
		1.1337635033738198828635697803913e-102,
		9.8015430427581747039938321770015e-90,
		2.7322376584674343582151194911907e-112,
		1.5626483658319048489991466031228e-111,
		2.4740726457742068716512589905519e-110,
		1.255004382382191225853720104851e-83,
		5.3060197739574511490869333454102e-86,
		2.1988176133168197366997962380787e-108,
		5.3432467021925060053885335662267e-106,
		4.7325154347610386289985716770046e-98,
		3.3917588621471843913571646826866e-113,
		2.245287069967328713459475802741e-97,
		8.0229344028703313358718424637939e-114,
		5.3027459026295078899797958970888e-98,
		1.3420916846377539087841893839828e-98,
		4.9589089957375653157832766878293e-108,
		9.0696536608227019286831581667131e-93,
		3.2802207694896751578275998241151e-96,
		4.2823004612243640618762948160199e-69,
		9.1888759095061186809673930635651e-108,
		4.074445294833961327810656071434e-101,
		2.9924827586745686522107907772935e-104,
		7.2613374928103460443906175313843e-109,
		3.4479427008733151806070965393015e-80,
		1.617655183075664848887124476215e-110,
		9.9095592699518807912922609183568e-112,
		2.2535163417123346933092355904627e-86,
		9.2008083547258190526658167922172e-107,
		7.5120447313033727371971257398658e-90,
		5.473077261498245704197043868226e-85,
		1.1528847379362286216633261039699e-74,
		9.495520528670039771729813528899e-105,
		5.8393233080299297443723927351413e-100,
		9.4868418816642592802920844139449e-110,
		1.5443707614034367457221006298324e-84,
		2.0189325579528197052570952844836e-75,
		3.7207316301275442373681915341799e-95,
		2.5020436208200471915729838967905e-97,
		1.6181089533316548420876061878002e-108
	])
}]


for t in tests:
	p = multivariate_t.pdf(t['x'], t['mu'], t['shape'], t['df'])
	print(np.allclose(p, t['ans'], atol=0.001))
